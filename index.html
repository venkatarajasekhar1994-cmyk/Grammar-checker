<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilingual Grammar & Sentence Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .result-card { border-left-width: 4px; }
        .result-card-error { border-left-color: #EF4444; } /* red-500 */
        .result-card-correct { border-left-color: #22C55E; } /* green-500 */
        .highlight-error { background-color: #FEE2E2; color: #DC2626; padding: 0 4px; border-radius: 3px; font-family: monospace; }
        .highlight-correct { background-color: #ECFDF5; color: #047857; padding: 0 4px; border-radius: 3px; font-weight: bold; font-family: monospace;}
    </style>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-lg">
        <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">Bilingual Grammar & Sentence Checker</h1>
        <p class="text-gray-600 mb-6 text-center">
            Enter your English text below. This tool checks for common grammar errors using a custom-built dictionary and rule set.
        </p>

        <div class="mb-4">
            <label for="text-input" class="block text-sm font-medium text-gray-700 mb-2">Your Text:</label>
            <textarea id="text-input" rows="12" class="w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., Yesterday I goes to market..."></textarea>
        </div>

        <div class="text-center mb-6">
            <button id="check-button" class="w-full md:w-auto bg-blue-600 text-white font-bold py-3 px-10 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                Check Grammar
            </button>
        </div>

        <div>
            <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">Results:</h2>
            <div id="results-output" class="space-y-4">
                <p id="no-errors-message" class="text-gray-500 italic">No issues found yet. Click "Check Grammar" to start!</p>
            </div>
        </div>
    </div>

    <script>
        // --- OUR CUSTOM "BRAIN" (మన సొంత "మెదడు") ---
        // This is the dictionary we must build ourselves, based on your JSONs and common English words.
        // AI లేకుండా దీన్ని తెలివైనదిగా చేయడానికి, మనం ఈ డిక్షనరీని నిరంతరం పెద్దదిగా చేయాలి.
        // మీ ఉదాహరణలోని అన్ని పదాలను నేను ఇక్కడ జోడించాను.
        const wordData = {
            // --- Nouns (నామవాచకాలు) ---
            "men": { type: "Noun", form: "Plural" },
            "man": { type: "Noun", form: "Singular" },
            "teacher": { type: "Noun", form: "Singular" },
            "teachers": { type: "Noun", form: "Plural" },
            "police": { type: "Noun", form: "Plural" }, // "police" is always plural
            "people": { type: "Noun", form: "Plural" },
            "person": { type: "Noun", form: "Singular" },
            "name": { type: "Noun", form: "Singular" },
            "names": { type: "Noun", form: "Plural" },
            "cow": { type: "Noun", form: "Singular" },
            "cows": { type: "Noun", form: "Plural" },
            "apples": { type: "Noun", form: "Plural" },
            "apple": { type: "Noun", form: "Singular" },
            "mango": { type: "Noun", form: "Singular" },
            "bananas": { type: "Noun", form: "Plural" },
            "friend": { type: "Noun", form: "Singular" },
            "fruits": { type: "Noun", form: "Plural" },
            "boy": { type: "Noun", form: "Singular" },
            "flowers": { type: "Noun", form: "Plural" },
            "mother": { type: "Noun", form: "Singular" },
            "cats": { type: "Noun", form: "Plural" },
            "dog": { type: "Noun", form: "Singular" },
            "home": { type: "Noun", form: "Singular" },
            "bus": { type: "Noun", form: "Singular" },
            "movie": { type: "Noun", form: "Singular" },
            "theatre": { type: "Noun", form: "Singular" },
            "garden": { type: "Noun", form: "Singular" },
            "store": { type: "Noun", form: "Singular" },
            "teacher": { type: "Noun", form: "Singular" },
            "project": { type: "Noun", form: "Singular" },
            "pizza": { type: "Noun", form: "Uncountable" },
            "school": { type: "Noun", form: "Singular" },
            "market": { type: "Noun", form: "Singular" },

            // --- Irregular Plurals (క్రమరహిత బహువచనాలు) ---
            "childs": { type: "Noun", form: "Misspelled", correct: "children" },
            "children": { type: "Noun", form: "Plural" },

            // --- Uncountable Nouns (లెక్కించలేనివి) ---
            "homework": { type: "Noun", form: "Uncountable" },
            "food": { type: "Noun", form: "Uncountable" },
            "bread": { type: "Noun", form: "Uncountable" },
            "foods": { type: "Noun", form: "Misspelled", correct: "food" },
            "breads": { type: "Noun", form: "Misspelled", correct: "bread" },
            "every": { type: "Determiner" },
            "days": { type: "Noun", form: "Plural" },
            "day": { type: "Noun", form: "Singular" },
            
            // --- Pronouns (సర్వనామాలు) ---
            "i": { type: "Pronoun", form: "Singular", special: "I" },
            "he": { type: "Pronoun", form: "Singular" },
            "she": { type: "Pronoun", form: "Singular" },
            "it": { type: "Pronoun", form: "Singular" },
            "they": { type: "Pronoun", form: "Plural" },
            "we": { type: "Pronoun", form: "Plural" },
            "you": { type: "Pronoun", form: "Plural" }, // 'you' always takes a plural verb
            "me": { type: "Pronoun", form: "Object" },
            "him": { type: "Pronoun", form: "Object" },
            "my": { type: "Determiner" },

            // --- Verbs (క్రియలు) ---
            "is": { type: "Verb", form: "Singular", tense: "Present", plural: "are", base: "be", v2: "was" },
            "are": { type: "Verb", form: "Plural", tense: "Present", singular: "is", base: "be", v2: "were" },
            "was": { type: "Verb", form: "Singular", tense: "Past", plural: "were", base: "be" },
            "were": { type: "Verb", form: "Plural", tense: "Past", singular: "was", base: "be" },
            "has": { type: "Verb", form: "Singular", tense: "Present", plural: "have", base: "have", v2: "had" },
            "have": { type: "Verb", form: "Plural", tense: "Present", singular: "has", base: "have", v2: "had" },
            "goes": { type: "Verb", form: "Singular", tense: "Present", base: "go", v2: "went", plural: "go" },
            "go": { type: "Verb", form: "Plural", tense: "Present", base: "go", v2: "went", v5: "goes" },
            "tell": { type: "Verb", form: "Plural", tense: "Present", base: "tell", v2: "told", v5: "tells" },
            "tells": { type: "Verb", form: "Singular", tense: "Present", base: "tell", v2: "told", plural: "tell" },
            "look": { type: "Verb", form: "Plural", tense: "Present", base: "look", v2: "looked", v5: "looks" },
            "looks": { type: "Verb", form: "Singular", tense: "Present", base: "look", v2: "looked", plural: "look" },
            "give": { type: "Verb", form: "Plural", tense: "Present", base: "give", v2: "gave" },
            "smile": { type: "Verb", form: "Plural", tense: "Present", base: "smile", v2: "smiled", v5: "smiles" },
            "smiles": { type: "Verb", form: "Singular", tense: "Present", base: "smile", v2: "smiled", plural: "smile" },
            "do": { type: "Verb", form: "Plural", tense: "Present", base: "do", v2: "did", v5: "does" },
            "scold": { type: "Verb", form: "Plural", tense: "Present", base: "scold", v2: "scolded" },
            "like": { type: "Verb", form: "Plural", tense: "Present", base: "like", v5: "likes" },
            "likes": { type: "Verb", form: "Singular", tense: "Present", base: "like", plural: "like" },
            "cook": { type: "Verb", form: "Plural", tense: "Present", base: "cook", v2: "cooked", v5: "cooks" },
            "cooks": { type: "Verb", form: "Singular", tense: "Present", base: "cook", v2: "cooked", plural: "cook" },
            "plays": { type: "Verb", form: "Singular", tense: "Present", base: "play", v2: "played", plural: "play" },
            "play": { type: "Verb", form: "Plural", tense: "Present", base: "play", v2: "played", v5: "plays" },
            
            // --- Progressive Verbs (కొనసాగుతున్న క్రియలు) ---
            "eating": { type: "Verb", form: "Progressive", base: "eat" },
            "coming": { type: "Verb", form: "Progressive", base: "come" },
            "going": { type: "Verb", form: "Progressive", base: "go" },
            "watching": { type: "Verb", form: "Progressive", base: "watch" },
            "selling": { type: "Verb", form: "Progressive", base: "sell" },

            // --- Tense Indicators (కాల సూచికలు) ---
            "yesterday": { type: "TenseIndicator", tense: "Past" },
            "ago": { type: "TenseIndicator", tense: "Past" },
            "last": { type: "TenseIndicator", tense: "Past" }, // e.g., last night

            // --- Prepositions / Conjunctions ---
            "to": { type: "Preposition" },
            "at": { type: "Preposition" },
            "in": { type: "Preposition" },
            "not": { type: "Negative" },
            "and": { type: "Conjunction" },
            "but": { type: "Conjunction" },
            "which": { type: "Pronoun", relative: true }, // "which" for person is wrong

            // --- Misspelled Verbs (తప్పు క్రియలు) ---
            "buyed": { type: "Verb", form: "Misspelled", base: "buy", correct: "bought" },
            "comed": { type: "Verb", form: "Misspelled", base: "come", correct: "came" },
            "seen": { type: "Verb", form: "PastParticiple", base: "see", v2: "saw" }, // V3 used as V2
            "runned": { type: "Verb", form: "Misspelled", base: "run", correct: "ran" },
            "speaked": { type: "Verb", form: "Misspelled", base: "speak", correct: "spoke" },

            // --- Helping Verbs (సహాయక క్రియలు) ---
            "don't": { type: "Verb", form: "Plural", tense: "Present", negative: true, singular: "doesn't", v2: "didn't" },
            "doesn't": { type: "Verb", form: "Singular", tense: "Present", negative: true, plural: "don't", v2: "didn't" },
            "didn't": { type: "Verb", form: "Past", negative: true }
        };

        // --- APPLICATION LOGIC (Smarter v7 with Full Sentence Correction) ---
        
        const checkButton = document.getElementById('check-button');
        const textInput = document.getElementById('text-input');
        const resultsOutput = document.getElementById('results-output');

        checkButton.addEventListener('click', checkGrammar);
        
        // Helper to match original word case
        function replaceWithSameCase(original, suggestion) {
            if (!original || !suggestion) return suggestion;

            // Case 1: ALL CAPS
            if (original === original.toUpperCase()) {
                return suggestion.toUpperCase();
            }
            
            // Case 2: Title Case (First letter capitalized, rest lowercase)
            if (original.charAt(0) === original.charAt(0).toUpperCase() && original.slice(1) === original.slice(1).toLowerCase()) {
                 return suggestion.charAt(0).toUpperCase() + suggestion.slice(1).toLowerCase();
            }
            
            // Default: return suggestion as-is (likely lowercase)
            return suggestion;
        }


        function checkGrammar() {
            const text = textInput.value;
            resultsOutput.innerHTML = ''; // Clear previous results
            let errorsFound = 0;
            let overallErrors = 0; // To track total errors across all sentences

            const sentences = text.match(/[^.!?]+[.!?]*/g) || [text]; // Split into sentences
            
            sentences.forEach(sentence => {
                let originalSentence = sentence.trim();
                if (!originalSentence) return;
                
                errorsFound = 0; // Reset for each sentence
                let hasCorrections = false; // Track if we made simple replacements
                
                // Store words with original punctuation for accurate suggestions
                const wordsWithPunct = originalSentence.split(/(\s+)/); // Split but keep spaces
                let correctedWords = [...wordsWithPunct]; // Copy for modifications
                const cleanWords = originalSentence.toLowerCase().split(/\s+/).map(w => w.replace(/[.,!?]/g, ''));
                
                let requiredTense = "Present"; // Default
                let subject = null;
                let subjectWord = "";
                let subjectIndex = -1;
                let lastVerbIndex = -1; // To link tense errors to verbs

                // --- 1. Tense Check (కాలం తనిఖీ) ---
                // "Yesterday", "last night" వంటి పదాల కోసం వాక్యం మొత్తం తనిఖీ చేయండి
                for (const word of cleanWords) {
                    if (wordData[word]?.type === "TenseIndicator" && wordData[word].tense === "Past") {
                        requiredTense = "Past";
                        break;
                    }
                }

                // --- 2. Iterate through words to find errors ---
                for (let i = 0; i < cleanWords.length; i++) {
                    const word = cleanWords[i];
                    const data = wordData[word];
                    
                    if (!data) continue; // Word not in our dictionary

                    // Find Subject (కర్తను కనుగొనండి)
                    if (!subject && (data.type === "Noun" || data.type === "Pronoun") && data.form !== "Object") {
                        subject = data;
                        subjectWord = wordsWithPunct[i*2].replace(/[.,!?]/g, ''); // Original case
                        subjectIndex = i;
                    }

                    // --- ERROR CHECKS (తప్పుల తనిఖీ) ---

                    // A. Tense Error (కాలం తప్పు)
                    // e.g., "Yesterday I *goes*..." or "We *is watching* movie last night"
                    if (requiredTense === "Past" && data.type === "Verb" && data.tense === "Present") {
                        if (subject && i > subjectIndex) { // Verb must follow subject
                            errorsFound++;
                            const originalVerb = wordsWithPunct[i*2];
                            
                            // Determine correct past tense verb
                            let correctVerb = data.v2; // e.g., "goes" -> "went", "don't" -> "didn't"
                            if (!correctVerb) {
                                if (word === 'is') correctVerb = 'was';
                                else if (word === 'are') correctVerb = 'were';
                                else if (data.base) correctVerb = data.base + 'ed'; // Simple guess
                            }
                            // Fallback for words like 'cooks' which might not have v2 defined
                            if (!correctVerb && data.base) correctVerb = data.base + 'ed'; 
                            
                            if (correctVerb) {
                                correctedWords[i*2] = replaceWithSameCase(originalVerb, correctVerb);
                                hasCorrections = true;
                                displayError(
                                    `Found Issue: <span class="highlight-error">${originalVerb}</span> (with 'Yesterday'/'last')`,
                                    "Past Tense Error (గత కాలం తప్పు)",
                                    `The sentence indicates past time (e.g., 'Yesterday', 'last night'), but you used a present tense verb.`,
                                    `వాక్యం గతాన్ని సూచిస్తుంది, కానీ మీరు వర్తమాన కాల క్రియను ఉపయోగించారు.`,
                                    `మీరు బహుశా ఇలా చెప్పాలనుకున్నారు: <span class="highlight-correct">${correctVerb}</span>`
                                );
                            }
                            // DO NOT reset subject: subject = null;
                        }
                    }

                    // B. Misspelled/Irregular Verb Error (తప్పు క్రియ)
                    // e.g., "...I *buyed*..." or "...He *runned*..."
                    if (data.type === "Verb" && data.form === "Misspelled") {
                         errorsFound++;
                         const suggestedWord = data.correct;
                         correctedWords[i*2] = replaceWithSameCase(wordsWithPunct[i*2], suggestedWord);
                         hasCorrections = true;
                         displayError(
                            `Found Issue: <span class="highlight-error">${wordsWithPunct[i*2]}</span>`,
                            "Irregular Verb Error (క్రమరహిత క్రియ తప్పు)",
                            `'${word}' is not the correct past tense for '${data.base}'.`,
                            `'${data.base}' యొక్క సరైన గత కాల రూపం '${word}' కాదు.`,
                            `మీరు బహుశా ఇలా చెప్పాలనుకున్నారు: <span class="highlight-correct">${suggestedWord}</span>`
                        );
                    }
                    
                    // C. V2/V3 Confusion (V2/V3 గందరగోళం)
                    // e.g., "I *seen*..."
                    if (data.type === "Verb" && data.form === "PastParticiple" && subject && i > subjectIndex) {
                        if (cleanWords[i-1] !== 'have' && cleanWords[i-1] !== 'has' && cleanWords[i-1] !== 'had') {
                             errorsFound++;
                             const suggestedWord = data.v2;
                             correctedWords[i*2] = replaceWithSameCase(wordsWithPunct[i*2], suggestedWord);
                             hasCorrections = true;
                             displayError(
                                `Found Issue: <span class="highlight-error">${wordsWithPunct[i*2]}</span>`,
                                "Verb Form Error (క్రియా రూపం తప్పు)",
                                `'${word}' (V3) needs a helping verb (have, has, had). You probably mean the simple past tense (V2).`,
                                `'${word}' (V3)కు సహాయక క్రియ అవసరం. మీరు V2 రూపాన్ని వాడాలనుకుంటున్నారు.`,
                                `మీరు బహుశా ఇలా చెప్పాలనుకున్నారు: <span class="highlight-correct">${suggestedWord}</span>`
                            );
                             // DO NOT reset subject: subject = null;
                        }
                    }

                    // D. Subject-Verb Agreement (SVA) Error (కర్త-క్రియ ఒప్పందం తప్పు)
                    // e.g., "apples *is*..." or "She *don't*..." or "I *has*..."
                    // This rule should NOT run if a Tense Error was already found for this word
                    if (data.type === "Verb" && data.tense === "Present" && requiredTense !== "Past" && subject && i > subjectIndex) {
                        const originalVerb = wordsWithPunct[i*2];
                        if (subject.form === "Singular" && subject.special !== "I" && data.form === "Plural") {
                             errorsFound++;
                             const suggestedWord = data.v5 || data.singular || (data.base + 's');
                             correctedWords[i*2] = replaceWithSameCase(originalVerb, suggestedWord);
                             hasCorrections = true;
                             displayError(
                                `Found Issue: <span class="highlight-error">${subjectWord} ${originalV
